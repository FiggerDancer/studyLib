<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/studyLib/assets/icon.jpeg"><title>React | 学习资源库</title><meta name="description" content="一个用于学习的 VuePress 站点">
    <link rel="preload" href="/studyLib/assets/style-97653313.css" as="style"><link rel="stylesheet" href="/studyLib/assets/style-97653313.css">
    <link rel="modulepreload" href="/studyLib/assets/app-72993491.js"><link rel="modulepreload" href="/studyLib/assets/005React.html-9ec40e07.js"><link rel="modulepreload" href="/studyLib/assets/005React.html-b6a0b20d.js"><link rel="prefetch" href="/studyLib/assets/index.html-2efa10d1.js" as="script"><link rel="prefetch" href="/studyLib/assets/001offer.html-bac406b1.js" as="script"><link rel="prefetch" href="/studyLib/assets/001Sort.html-befbd5f8.js" as="script"><link rel="prefetch" href="/studyLib/assets/002LinkList.html-d9751673.js" as="script"><link rel="prefetch" href="/studyLib/assets/003BinaryTree.html-7e39dc29.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Graph.html-73dd72b0.js" as="script"><link rel="prefetch" href="/studyLib/assets/005TrieTree.html-fb5bbdee.js" as="script"><link rel="prefetch" href="/studyLib/assets/006Greedy.html-463b0c00.js" as="script"><link rel="prefetch" href="/studyLib/assets/007BruteForceRecursion.html-c32612ce.js" as="script"><link rel="prefetch" href="/studyLib/assets/008Hash.html-dfd72b4a.js" as="script"><link rel="prefetch" href="/studyLib/assets/009DisjointSet.html-c1da4bda.js" as="script"><link rel="prefetch" href="/studyLib/assets/010KMP.html-08dc4939.js" as="script"><link rel="prefetch" href="/studyLib/assets/011Manacher.html-851a418a.js" as="script"><link rel="prefetch" href="/studyLib/assets/012Window.html-35ce89c5.js" as="script"><link rel="prefetch" href="/studyLib/assets/013大数据.html-08dc39af.js" as="script"><link rel="prefetch" href="/studyLib/assets/014位运算.html-7156ded7.js" as="script"><link rel="prefetch" href="/studyLib/assets/015动态规划.html-19b0a341.js" as="script"><link rel="prefetch" href="/studyLib/assets/016有序表.html-bd8c7167.js" as="script"><link rel="prefetch" href="/studyLib/assets/001es.html-61c7fbb3.js" as="script"><link rel="prefetch" href="/studyLib/assets/002lodash.html-2bcf0815.js" as="script"><link rel="prefetch" href="/studyLib/assets/003coding.html-f5926cd9.js" as="script"><link rel="prefetch" href="/studyLib/assets/001打包资源处理.html-24cdc3ab.js" as="script"><link rel="prefetch" href="/studyLib/assets/002webpack配置.html-220baa49.js" as="script"><link rel="prefetch" href="/studyLib/assets/003包管理工具.html-159b64a3.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Bundless.html-ae5a7555.js" as="script"><link rel="prefetch" href="/studyLib/assets/005手写简单webpack.html-2bf49e9b.js" as="script"><link rel="prefetch" href="/studyLib/assets/006模块化方案.html-9a5a76f5.js" as="script"><link rel="prefetch" href="/studyLib/assets/007package和npm.html-8a15325e.js" as="script"><link rel="prefetch" href="/studyLib/assets/008前端质量保障.html-dfab7e01.js" as="script"><link rel="prefetch" href="/studyLib/assets/010rspack.html-19004f0d.js" as="script"><link rel="prefetch" href="/studyLib/assets/001CSS.html-77bdfb21.js" as="script"><link rel="prefetch" href="/studyLib/assets/002Browser.html-fb8c4e1d.js" as="script"><link rel="prefetch" href="/studyLib/assets/003JS.html-6511db18.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Vue.html-60dc2bc0.js" as="script"><link rel="prefetch" href="/studyLib/assets/006工程化.html-4474284b.js" as="script"><link rel="prefetch" href="/studyLib/assets/007Http.html-024ba735.js" as="script"><link rel="prefetch" href="/studyLib/assets/008算法.html-a7f80b9d.js" as="script"><link rel="prefetch" href="/studyLib/assets/011前端调试.html-2653b38b.js" as="script"><link rel="prefetch" href="/studyLib/assets/012装饰器.html-1143f938.js" as="script"><link rel="prefetch" href="/studyLib/assets/997面试题整理.html-30dd7c1f.js" as="script"><link rel="prefetch" href="/studyLib/assets/998HR面.html-4fe89dde.js" as="script"><link rel="prefetch" href="/studyLib/assets/999Other.html-2bafb8e9.js" as="script"><link rel="prefetch" href="/studyLib/assets/001nestjs.html-323234b5.js" as="script"><link rel="prefetch" href="/studyLib/assets/002nestjs装饰器.html-0fb187a0.js" as="script"><link rel="prefetch" href="/studyLib/assets/003nestjs切换上下文.html-97aab697.js" as="script"><link rel="prefetch" href="/studyLib/assets/001React.html-cf1dd876.js" as="script"><link rel="prefetch" href="/studyLib/assets/001Vue.html-fce47e30.js" as="script"><link rel="prefetch" href="/studyLib/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/studyLib/assets/index.html-0c7c69f6.js" as="script"><link rel="prefetch" href="/studyLib/assets/001offer.html-191fdbe5.js" as="script"><link rel="prefetch" href="/studyLib/assets/001Sort.html-280b53df.js" as="script"><link rel="prefetch" href="/studyLib/assets/002LinkList.html-fb9c1719.js" as="script"><link rel="prefetch" href="/studyLib/assets/003BinaryTree.html-9a24013b.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Graph.html-0dad7abb.js" as="script"><link rel="prefetch" href="/studyLib/assets/005TrieTree.html-34ca2d6a.js" as="script"><link rel="prefetch" href="/studyLib/assets/006Greedy.html-78f96504.js" as="script"><link rel="prefetch" href="/studyLib/assets/007BruteForceRecursion.html-b2eb33b2.js" as="script"><link rel="prefetch" href="/studyLib/assets/008Hash.html-244a9c67.js" as="script"><link rel="prefetch" href="/studyLib/assets/009DisjointSet.html-cfc4bfc7.js" as="script"><link rel="prefetch" href="/studyLib/assets/010KMP.html-2398b546.js" as="script"><link rel="prefetch" href="/studyLib/assets/011Manacher.html-4b7ab50b.js" as="script"><link rel="prefetch" href="/studyLib/assets/012Window.html-42f82a81.js" as="script"><link rel="prefetch" href="/studyLib/assets/013大数据.html-0dcbf045.js" as="script"><link rel="prefetch" href="/studyLib/assets/014位运算.html-aa0f7ce8.js" as="script"><link rel="prefetch" href="/studyLib/assets/015动态规划.html-83a6ee15.js" as="script"><link rel="prefetch" href="/studyLib/assets/016有序表.html-7be4c959.js" as="script"><link rel="prefetch" href="/studyLib/assets/001es.html-18faa3ab.js" as="script"><link rel="prefetch" href="/studyLib/assets/002lodash.html-27e15aa1.js" as="script"><link rel="prefetch" href="/studyLib/assets/003coding.html-472500dc.js" as="script"><link rel="prefetch" href="/studyLib/assets/001打包资源处理.html-079090a7.js" as="script"><link rel="prefetch" href="/studyLib/assets/002webpack配置.html-1c5b4b6b.js" as="script"><link rel="prefetch" href="/studyLib/assets/003包管理工具.html-aea79c2b.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Bundless.html-ee1d00f3.js" as="script"><link rel="prefetch" href="/studyLib/assets/005手写简单webpack.html-b669b110.js" as="script"><link rel="prefetch" href="/studyLib/assets/006模块化方案.html-1cb5a0fc.js" as="script"><link rel="prefetch" href="/studyLib/assets/007package和npm.html-f059a92c.js" as="script"><link rel="prefetch" href="/studyLib/assets/008前端质量保障.html-a2f1ba4f.js" as="script"><link rel="prefetch" href="/studyLib/assets/010rspack.html-bb5ff69e.js" as="script"><link rel="prefetch" href="/studyLib/assets/001CSS.html-d1d3362c.js" as="script"><link rel="prefetch" href="/studyLib/assets/002Browser.html-aaf69bf6.js" as="script"><link rel="prefetch" href="/studyLib/assets/003JS.html-deb0bda6.js" as="script"><link rel="prefetch" href="/studyLib/assets/004Vue.html-e1a4995f.js" as="script"><link rel="prefetch" href="/studyLib/assets/006工程化.html-b5a145c3.js" as="script"><link rel="prefetch" href="/studyLib/assets/007Http.html-b5f4113b.js" as="script"><link rel="prefetch" href="/studyLib/assets/008算法.html-08a07cf3.js" as="script"><link rel="prefetch" href="/studyLib/assets/011前端调试.html-4aa4bd45.js" as="script"><link rel="prefetch" href="/studyLib/assets/012装饰器.html-b7656a34.js" as="script"><link rel="prefetch" href="/studyLib/assets/997面试题整理.html-fc44ed4d.js" as="script"><link rel="prefetch" href="/studyLib/assets/998HR面.html-d0fbcf2a.js" as="script"><link rel="prefetch" href="/studyLib/assets/999Other.html-82442ece.js" as="script"><link rel="prefetch" href="/studyLib/assets/001nestjs.html-88dfddd2.js" as="script"><link rel="prefetch" href="/studyLib/assets/002nestjs装饰器.html-c78d21e8.js" as="script"><link rel="prefetch" href="/studyLib/assets/003nestjs切换上下文.html-e7c74e97.js" as="script"><link rel="prefetch" href="/studyLib/assets/001React.html-63986f09.js" as="script"><link rel="prefetch" href="/studyLib/assets/001Vue.html-4cac51c8.js" as="script"><link rel="prefetch" href="/studyLib/assets/404.html-11fb8e97.js" as="script"><link rel="prefetch" href="/studyLib/assets/mermaid.core-d22b6d45.js" as="script"><link rel="prefetch" href="/studyLib/assets/markdown.esm-abe06b83.js" as="script"><link rel="prefetch" href="/studyLib/assets/reveal.esm-ec5549c1.js" as="script"><link rel="prefetch" href="/studyLib/assets/VuePlayground-eb9a6c49.js" as="script"><link rel="prefetch" href="/studyLib/assets/giscus-765fdce2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="切换侧边栏" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/studyLib/" class=""><!----><span class="site-name">学习资源库</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/studyLib/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/algorithm/001Sort.md" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/LeetCode/001offer.md" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/engineering/001打包资源处理.md" class="" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/studyLib/framework/vue/001Vue.md" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/framework/react/001React.md" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/framework/nestjs/001nestjs.md" class="" aria-label="NestJS"><!--[--><!--]--> NestJS <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试"><span class="title">面试</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试"><span class="title">面试</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/studyLib/questions/001CSS.md" class="" aria-label="问题"><!--[--><!--]--> 问题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/coding/001es.md" class="" aria-label="代码"><!--[--><!--]--> 代码 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="Search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/studyLib/" class="" aria-label="首页"><!--[--><!--]--> 首页 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/algorithm/001Sort.md" class="" aria-label="算法"><!--[--><!--]--> 算法 <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/LeetCode/001offer.md" class="" aria-label="LeetCode"><!--[--><!--]--> LeetCode <!--[--><!--]--></a></div><div class="navbar-item"><a href="/studyLib/engineering/001打包资源处理.md" class="" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="框架"><span class="title">框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="框架"><span class="title">框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/studyLib/framework/vue/001Vue.md" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/framework/react/001React.md" class="" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/framework/nestjs/001nestjs.md" class="" aria-label="NestJS"><!--[--><!--]--> NestJS <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="面试"><span class="title">面试</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="面试"><span class="title">面试</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/studyLib/questions/001CSS.md" class="" aria-label="问题"><!--[--><!--]--> 问题 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/studyLib/coding/001es.md" class="" aria-label="代码"><!--[--><!--]--> 代码 <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><a href="/studyLib/questions/001CSS.html" class="sidebar-item sidebar-heading" aria-label="CSS"><!--[--><!--]--> CSS <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/002Browser.html" class="sidebar-item sidebar-heading" aria-label="浏览器"><!--[--><!--]--> 浏览器 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/003JS.html" class="sidebar-item sidebar-heading" aria-label="JS"><!--[--><!--]--> JS <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/004Vue.html" class="sidebar-item sidebar-heading" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html" class="router-link-active router-link-exact-active router-link-active sidebar-item sidebar-heading active" aria-label="React"><!--[--><!--]--> React <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#react哲学" class="router-link-active router-link-exact-active sidebar-item" aria-label="React哲学"><!--[--><!--]--> React哲学 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#组件化" class="router-link-active router-link-exact-active sidebar-item" aria-label="组件化"><!--[--><!--]--> 组件化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#单向数据流" class="router-link-active router-link-exact-active sidebar-item" aria-label="单向数据流"><!--[--><!--]--> 单向数据流 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#响应式-state应该放在哪" class="router-link-active router-link-exact-active sidebar-item" aria-label="响应式，state应该放在哪"><!--[--><!--]--> 响应式，state应该放在哪 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#反向数据流-事件-组件通信" class="router-link-active router-link-exact-active sidebar-item" aria-label="反向数据流，事件，组件通信"><!--[--><!--]--> 反向数据流，事件，组件通信 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usestate" class="router-link-active router-link-exact-active sidebar-item" aria-label="useState"><!--[--><!--]--> useState <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#构建state的原则" class="router-link-active router-link-exact-active sidebar-item" aria-label="构建state的原则"><!--[--><!--]--> 构建state的原则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#不推荐修改state的理由" class="router-link-active router-link-exact-active sidebar-item" aria-label="不推荐修改state的理由"><!--[--><!--]--> 不推荐修改state的理由 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#实现原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="实现原理"><!--[--><!--]--> 实现原理 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#响应事件" class="router-link-active router-link-exact-active sidebar-item" aria-label="响应事件"><!--[--><!--]--> 响应事件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#渲染" class="router-link-active router-link-exact-active sidebar-item" aria-label="渲染"><!--[--><!--]--> 渲染 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#更新步骤" class="router-link-active router-link-exact-active sidebar-item" aria-label="更新步骤"><!--[--><!--]--> 更新步骤 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#flushsync" class="router-link-active router-link-exact-active sidebar-item" aria-label="flushSync"><!--[--><!--]--> flushSync <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#为什么不要嵌套定义组件函数" class="router-link-active router-link-exact-active sidebar-item" aria-label="为什么不要嵌套定义组件函数"><!--[--><!--]--> 为什么不要嵌套定义组件函数 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#组件间共享状态" class="router-link-active router-link-exact-active sidebar-item" aria-label="组件间共享状态"><!--[--><!--]--> 组件间共享状态 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#reducer" class="router-link-active router-link-exact-active sidebar-item" aria-label="reducer"><!--[--><!--]--> reducer <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#优势劣势" class="router-link-active router-link-exact-active sidebar-item" aria-label="优势劣势"><!--[--><!--]--> 优势劣势 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usereducer" class="router-link-active router-link-exact-active sidebar-item" aria-label="useReducer"><!--[--><!--]--> useReducer <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useimmerreducer" class="router-link-active router-link-exact-active sidebar-item" aria-label="useImmerReducer"><!--[--><!--]--> useImmerReducer <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#context" class="router-link-active router-link-exact-active sidebar-item" aria-label="Context"><!--[--><!--]--> Context <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#使用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用场景"><!--[--><!--]--> 使用场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#reducer和context混合" class="router-link-active router-link-exact-active sidebar-item" aria-label="Reducer和Context混合"><!--[--><!--]--> Reducer和Context混合 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#createcontext" class="router-link-active router-link-exact-active sidebar-item" aria-label="createContext"><!--[--><!--]--> createContext <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useref" class="router-link-active router-link-exact-active sidebar-item" aria-label="useRef"><!--[--><!--]--> useRef <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#使用场景-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用场景"><!--[--><!--]--> 使用场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useimperativehandle" class="router-link-active router-link-exact-active sidebar-item" aria-label="useImperativeHandle"><!--[--><!--]--> useImperativeHandle <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#react何时添加refs" class="router-link-active router-link-exact-active sidebar-item" aria-label="React何时添加refs"><!--[--><!--]--> React何时添加refs <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#使用-refs-操作-dom-的最佳实践" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 refs 操作 DOM 的最佳实践"><!--[--><!--]--> 使用 refs 操作 DOM 的最佳实践 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useeffect" class="router-link-active router-link-exact-active sidebar-item" aria-label="useEffect"><!--[--><!--]--> useEffect <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#编写规则" class="router-link-active router-link-exact-active sidebar-item" aria-label="编写规则"><!--[--><!--]--> 编写规则 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="生命周期"><!--[--><!--]--> 生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#副作用包裹" class="router-link-active router-link-exact-active sidebar-item" aria-label="副作用包裹"><!--[--><!--]--> 副作用包裹 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useeffect指定依赖" class="router-link-active router-link-exact-active sidebar-item" aria-label="useEffect指定依赖"><!--[--><!--]--> useEffect指定依赖 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#总结" class="router-link-active router-link-exact-active sidebar-item" aria-label="总结"><!--[--><!--]--> 总结 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usememo" class="router-link-active router-link-exact-active sidebar-item" aria-label="useMemo"><!--[--><!--]--> useMemo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usesyncexternalstore" class="router-link-active router-link-exact-active sidebar-item" aria-label="useSyncExternalStore"><!--[--><!--]--> useSyncExternalStore <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useeffectevent" class="router-link-active router-link-exact-active sidebar-item" aria-label="useEffectEvent"><!--[--><!--]--> useEffectEvent <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#自定义hook" class="router-link-active router-link-exact-active sidebar-item" aria-label="自定义Hook"><!--[--><!--]--> 自定义Hook <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usetransition" class="router-link-active router-link-exact-active sidebar-item" aria-label="useTransition"><!--[--><!--]--> useTransition <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#使用-usetransition" class="router-link-active router-link-exact-active sidebar-item" aria-label="使用 useTransition"><!--[--><!--]--> 使用 useTransition <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#其他api" class="router-link-active router-link-exact-active sidebar-item" aria-label="其他API"><!--[--><!--]--> 其他API <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/studyLib/questions/005React.html#fragment" class="router-link-active router-link-exact-active sidebar-item" aria-label="Fragment"><!--[--><!--]--> Fragment <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#profiler" class="router-link-active router-link-exact-active sidebar-item" aria-label="Profiler"><!--[--><!--]--> Profiler <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#strictmode" class="router-link-active router-link-exact-active sidebar-item" aria-label="StrictMode"><!--[--><!--]--> StrictMode <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#suspense" class="router-link-active router-link-exact-active sidebar-item" aria-label="Suspense"><!--[--><!--]--> Suspense <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usedebugvalue" class="router-link-active router-link-exact-active sidebar-item" aria-label="useDebugValue"><!--[--><!--]--> useDebugValue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#usedeferredvalue" class="router-link-active router-link-exact-active sidebar-item" aria-label="useDeferredValue"><!--[--><!--]--> useDeferredValue <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useid" class="router-link-active router-link-exact-active sidebar-item" aria-label="useId"><!--[--><!--]--> useId <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useimperativehandle-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="useImperativeHandle"><!--[--><!--]--> useImperativeHandle <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#useinsertioneffect" class="router-link-active router-link-exact-active sidebar-item" aria-label="useInsertionEffect"><!--[--><!--]--> useInsertionEffect <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#uselayouteffect" class="router-link-active router-link-exact-active sidebar-item" aria-label="useLayoutEffect"><!--[--><!--]--> useLayoutEffect <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#forwardref" class="router-link-active router-link-exact-active sidebar-item" aria-label="forwardRef"><!--[--><!--]--> forwardRef <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#lazy" class="router-link-active router-link-exact-active sidebar-item" aria-label="lazy"><!--[--><!--]--> lazy <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#memo" class="router-link-active router-link-exact-active sidebar-item" aria-label="memo"><!--[--><!--]--> memo <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#starttransition" class="router-link-active router-link-exact-active sidebar-item" aria-label="startTransition"><!--[--><!--]--> startTransition <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#createportal" class="router-link-active router-link-exact-active sidebar-item" aria-label="createPortal"><!--[--><!--]--> createPortal <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#createroot" class="router-link-active router-link-exact-active sidebar-item" aria-label="createRoot"><!--[--><!--]--> createRoot <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#hydrateroot" class="router-link-active router-link-exact-active sidebar-item" aria-label="hydrateRoot"><!--[--><!--]--> hydrateRoot <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/studyLib/questions/005React.html#vue和react的区别-作业帮" class="router-link-active router-link-exact-active sidebar-item" aria-label="Vue和React的区别（作业帮）"><!--[--><!--]--> Vue和React的区别（作业帮） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#react为什么需要fiber-是为了解决什么问题的-作业帮" class="router-link-active router-link-exact-active sidebar-item" aria-label="React为什么需要Fiber，是为了解决什么问题的（作业帮）"><!--[--><!--]--> React为什么需要Fiber，是为了解决什么问题的（作业帮） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/studyLib/questions/005React.html#react、vue项目为什么要在列表组件中写key-其作用是什么-滴滴、饿了么" class="router-link-active router-link-exact-active sidebar-item" aria-label="React、Vue项目为什么要在列表组件中写key，其作用是什么？（滴滴、饿了么）"><!--[--><!--]--> React、Vue项目为什么要在列表组件中写key，其作用是什么？（滴滴、饿了么） <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/studyLib/questions/006%E5%B7%A5%E7%A8%8B%E5%8C%96.html" class="sidebar-item sidebar-heading" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/007Http.html" class="sidebar-item sidebar-heading" aria-label="HTTP"><!--[--><!--]--> HTTP <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/008%E7%AE%97%E6%B3%95.html" class="sidebar-item sidebar-heading" aria-label="/questions/008算法.md"><!--[--><!--]--> /questions/008算法.md <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/011%E5%89%8D%E7%AB%AF%E8%B0%83%E8%AF%95.html" class="sidebar-item sidebar-heading" aria-label="前端调试"><!--[--><!--]--> 前端调试 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/012%E8%A3%85%E9%A5%B0%E5%99%A8.html" class="sidebar-item sidebar-heading" aria-label="装饰器"><!--[--><!--]--> 装饰器 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/997%E9%9D%A2%E8%AF%95%E9%A2%98%E6%95%B4%E7%90%86.html" class="sidebar-item sidebar-heading" aria-label="面经"><!--[--><!--]--> 面经 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/998HR%E9%9D%A2.html" class="sidebar-item sidebar-heading" aria-label="HR面"><!--[--><!--]--> HR面 <!--[--><!--]--></a><!----></li><li><a href="/studyLib/questions/999Other.html" class="sidebar-item sidebar-heading" aria-label="其他"><!--[--><!--]--> 其他 <!--[--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="react" tabindex="-1"><a class="header-anchor" href="#react" aria-hidden="true">#</a> React</h1><h2 id="react哲学" tabindex="-1"><a class="header-anchor" href="#react哲学" aria-hidden="true">#</a> React哲学</h2><h3 id="组件化" tabindex="-1"><a class="header-anchor" href="#组件化" aria-hidden="true">#</a> 组件化</h3><ol><li>程序设计——使用同样的技术决定你是否应该创建一个新的函数或者对象。这一技术即 单一功能原理，也就是说，一个组件理想得仅做一件事情。但随着功能的持续增长，它应该被分解为更小的子组件。</li><li>CSS——思考你将把类选择器用于何处。(然而，组件并没有那么细的粒度。)</li><li>设计——思考你将如何组织布局的层级。</li></ol><h3 id="单向数据流" tabindex="-1"><a class="header-anchor" href="#单向数据流" aria-hidden="true">#</a> 单向数据流</h3><p>数据从树的顶层组件传递到下面的组件</p><h3 id="响应式-state应该放在哪" tabindex="-1"><a class="header-anchor" href="#响应式-state应该放在哪" aria-hidden="true">#</a> 响应式，state应该放在哪</h3><h3 id="反向数据流-事件-组件通信" tabindex="-1"><a class="header-anchor" href="#反向数据流-事件-组件通信" aria-hidden="true">#</a> 反向数据流，事件，组件通信</h3><h2 id="usestate" tabindex="-1"><a class="header-anchor" href="#usestate" aria-hidden="true">#</a> useState</h2><ol><li>Hooks ——以 use 开头的函数——只能在组件或自定义 Hook 的最顶层调用。 useState可以声明状态变量</li><li>你只能在组件的顶层或自己的Hook中调用它。开发者模式严格模式下，会调用两次初始化函数以及setState，验证它是否为纯函数。</li><li>setState通过Object.is比较前后state是否相同来决定是否要进行更新，所以你不要修改一个对象或者数组而是应该替换它。或者使用Immer这个库来完成更新，Immer提供了useImmer的钩子。与之相对应的Vue的ref和reactive都支持对象修改的响应式。</li><li>React会批量更新，会在所有事件处理函数调用set函数后更新UI，如果你需要强制更新屏幕，可以用flushSync</li><li>调用set不会立即修改state的值，而是在影响下一次渲染中useState返回的内容</li><li>set支持你传递的参数为一个函数或者一个真实的值</li><li>useState支持初始化函数，而不是一个默认值，这可以减少对资源的消耗</li><li>所有的组件都可以通过key来重置状态。请记住 key 不是全局唯一的。它们只能指定 父组件内部 的顺序。</li></ol><h3 id="构建state的原则" tabindex="-1"><a class="header-anchor" href="#构建state的原则" aria-hidden="true">#</a> 构建state的原则</h3><ol><li>合并关联的 state。如果你总是同时更新两个或更多的 state 变量，请考虑将它们合并为一个单独的 state 变量。</li><li>避免互相矛盾的 state。当 state 结构中存在多个相互矛盾或“不一致”的 state 时，你就可能为此会留下隐患。应尽量避免这种情况。</li><li>避免冗余的 state。如果你能在渲染期间从组件的 props 或其现有的 state 变量中计算出一些信息，则不应将这些信息放入该组件的 state 中。</li><li>避免重复的 state。当同一数据在多个 state 变量之间或在多个嵌套对象中重复时，这会很难保持它们同步。应尽可能减少重复。</li><li>避免深度嵌套的 state。深度分层的 state 更新起来不是很方便。如果可能的话，最好以扁平化方式构建 state。</li></ol><h3 id="不推荐修改state的理由" tabindex="-1"><a class="header-anchor" href="#不推荐修改state的理由" aria-hidden="true">#</a> 不推荐修改state的理由</h3><ol><li>调试：如果你使用 console.log 并且不直接修改 state，你之前日志中的 state 的值就不会被新的 state 变化所影响。这样你就可以清楚地看到两次渲染之间 state 的值发生了什么变化</li><li>优化：React 常见的 优化策略 依赖于如果之前的 props 或者 state 的值和下一次相同就跳过渲染。如果你从未直接修改 state ，那么你就可以很快看到 state 是否发生了变化。如果 prevObj === obj，那么你就可以肯定这个对象内部并没有发生改变。</li><li>新功能：我们正在构建的 React 的新功能依赖于 state 被 像快照一样看待 的理念。如果你直接修改 state 的历史版本，可能会影响你使用这些新功能。</li><li>需求变更：有些应用功能在不出现任何修改的情况下会更容易实现，比如实现撤销/恢复、展示修改历史，或是允许用户把表单重置成某个之前的值。这是因为你可以把 state 之前的拷贝保存到内存中，并适时对其进行再次使用。如果一开始就用了直接修改 state 的方式，那么后面要实现这样的功能就会变得非常困难。</li><li>更简单的实现：React 并不依赖于 mutation ，所以你不需要对对象进行任何特殊操作。它不需要像很多“响应式”的解决方案一样去劫持对象的属性、总是用代理把对象包裹起来，或者在初始化时做其他工作。这也是为什么 React 允许你把任何对象存放在 state 中——不管对象有多大——而不会造成有任何额外的性能或正确性问题的原因。</li></ol><h3 id="实现原理" tabindex="-1"><a class="header-anchor" href="#实现原理" aria-hidden="true">#</a> 实现原理</h3><p>将每个hook的状态放到React的hooks数组中以缓存。如果没有创建则新建一个存入数组，如果已经创建则取出。setState时则更新状态值然后更新DOM。实际上React使用的链表来存储hooks状态</p><p>简单实现：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> componentHooks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> currentHookIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token comment">// useState 在 React 中是如何工作的（简化版）</span>
<span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token parameter">initialState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> pair <span class="token operator">=</span> componentHooks<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pair<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这不是第一次渲染</span>
    <span class="token comment">// 所以 state pair 已经存在</span>
    <span class="token comment">// 将其返回并为下一次 hook 的调用做准备</span>
    currentHookIndex<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> pair<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 这是我们第一次进行渲染</span>
  <span class="token comment">// 所以新建一个 state pair 然后存储它</span>
  pair <span class="token operator">=</span> <span class="token punctuation">[</span>initialState<span class="token punctuation">,</span> setState<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">nextState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 当用户发起 state 的变更，</span>
    <span class="token comment">// 把新的值放入 pair 中</span>
    pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> nextState<span class="token punctuation">;</span>
    <span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 存储这个 pair 用于将来的渲染</span>
  <span class="token comment">// 并且为下一次 hook 的调用做准备</span>
  componentHooks<span class="token punctuation">[</span>currentHookIndex<span class="token punctuation">]</span> <span class="token operator">=</span> pair<span class="token punctuation">;</span>
  currentHookIndex<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> pair<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Gallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 每次调用 useState() 都会得到新的 pair</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>index<span class="token punctuation">,</span> setIndex<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>showMore<span class="token punctuation">,</span> setShowMore<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleNextClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setIndex</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">handleMoreClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setShowMore</span><span class="token punctuation">(</span><span class="token operator">!</span>showMore<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> sculpture <span class="token operator">=</span> sculptureList<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 这个例子没有使用 React，所以</span>
  <span class="token comment">// 返回一个对象而不是 JSX</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">onNextClick</span><span class="token operator">:</span> handleNextClick<span class="token punctuation">,</span>
    <span class="token literal-property property">onMoreClick</span><span class="token operator">:</span> handleMoreClick<span class="token punctuation">,</span>
    <span class="token literal-property property">header</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sculpture<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sculpture<span class="token punctuation">.</span>artist<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">counter</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>sculptureList<span class="token punctuation">.</span>length<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">more</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>showMore <span class="token operator">?</span> <span class="token string">&#39;Hide&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;Show&#39;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> details</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token literal-property property">description</span><span class="token operator">:</span> showMore <span class="token operator">?</span> sculpture<span class="token punctuation">.</span>description <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token literal-property property">imageSrc</span><span class="token operator">:</span> sculpture<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
    <span class="token literal-property property">imageAlt</span><span class="token operator">:</span> sculpture<span class="token punctuation">.</span>alt
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 在渲染组件之前</span>
  <span class="token comment">// 重置当前 Hook 的下标</span>
  currentHookIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token function">Gallery</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 更新 DOM 以匹配输出结果</span>
  <span class="token comment">// 这部分工作由 React 为你完成</span>
  nextButton<span class="token punctuation">.</span>onclick <span class="token operator">=</span> output<span class="token punctuation">.</span>onNextClick<span class="token punctuation">;</span>
  header<span class="token punctuation">.</span>textContent <span class="token operator">=</span> output<span class="token punctuation">.</span>header<span class="token punctuation">;</span>
  moreButton<span class="token punctuation">.</span>onclick <span class="token operator">=</span> output<span class="token punctuation">.</span>onMoreClick<span class="token punctuation">;</span>
  moreButton<span class="token punctuation">.</span>textContent <span class="token operator">=</span> output<span class="token punctuation">.</span>more<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>src <span class="token operator">=</span> output<span class="token punctuation">.</span>imageSrc<span class="token punctuation">;</span>
  image<span class="token punctuation">.</span>alt <span class="token operator">=</span> output<span class="token punctuation">.</span>imageAlt<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>output<span class="token punctuation">.</span>description <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">.</span>textContent <span class="token operator">=</span> output<span class="token punctuation">.</span>description<span class="token punctuation">;</span>
    description<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    description<span class="token punctuation">.</span>style<span class="token punctuation">.</span>display <span class="token operator">=</span> <span class="token string">&#39;none&#39;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用例</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> nextButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;nextButton&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> header <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;header&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> moreButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;moreButton&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> description <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;description&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> image <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&#39;image&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> sculptureList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Homenaje a la Neurocirugía&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Marta Colvin Andrade&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;Although Colvin is predominantly known for abstract themes that allude to pre-Hispanic symbols, this gigantic sculpture, an homage to neurosurgery, is one of her most recognizable public art pieces.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/Mx7dA2Y.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A bronze statue of two crossed hands delicately holding a human brain in their fingertips.&#39;</span>  
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Floralis Genérica&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Eduardo Catalano&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;This enormous (75 ft. or 23m) silver flower is located in Buenos Aires. It is designed to move, closing its petals in the evening or when strong winds blow and opening them in the morning.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/ZF6s192m.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A gigantic metallic flower sculpture with reflective mirror-like petals and strong stamens.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Eternal Presence&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;John Woodrow Wilson&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;Wilson was known for his preoccupation with equality, social justice, as well as the essential and spiritual qualities of humankind. This massive (7ft. or 2,13m) bronze represents what he described as &quot;a symbolic Black presence infused with a sense of universal humanity.&quot;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/aTtVpES.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;The sculpture depicting a human head seems ever-present and solemn. It radiates calm and serenity.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Moai&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Unknown Artist&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;Located on the Easter Island, there are 1,000 moai, or extant monumental statues, created by the early Rapa Nui people, which some believe represented deified ancestors.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/RCwLEoQm.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;Three monumental stone busts with the heads that are disproportionately large with somber faces.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Blue Nana&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Niki de Saint Phalle&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;The Nanas are triumphant creatures, symbols of femininity and maternity. Initially, Saint Phalle used fabric and found objects for the Nanas, and later on introduced polyester to achieve a more vibrant effect.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/Sd1AgUOm.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A large mosaic sculpture of a whimsical dancing female figure in a colorful costume emanating joy.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Ultimate Form&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Barbara Hepworth&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;This abstract bronze sculpture is a part of The Family of Man series located at Yorkshire Sculpture Park. Hepworth chose not to create literal representations of the world but developed abstract forms inspired by people and landscapes.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/2heNQDcm.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A tall sculpture made of three elements stacked on each other reminding of a human figure.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Cavaliere&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Lamidi Olonade Fakeye&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;Descended from four generations of woodcarvers, Fakeye&#39;s work blended traditional and contemporary Yoruba themes.&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/wIdGuZwm.png&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;An intricate wood sculpture of a warrior with a focused face on a horse adorned with patterns.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Big Bellies&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Alina Szapocznikow&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&quot;Szapocznikow is known for her sculptures of the fragmented body as a metaphor for the fragility and impermanence of youth and beauty. This sculpture depicts two very realistic large bellies stacked on top of each other, each around five feet (1,5m) tall.&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/AlHTAdDm.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;The sculpture reminds a cascade of folds, quite different from bellies in classical sculptures.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Terracotta Army&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Unknown Artist&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;The Terracotta Army is a collection of terracotta sculptures depicting the armies of Qin Shi Huang, the first Emperor of China. The army consisted of more than 8,000 soldiers, 130 chariots with 520 horses, and 150 cavalry horses.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/HMFmH6m.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;12 terracotta sculptures of solemn warriors, each with a unique facial expression and armor.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Lunar Landscape&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Louise Nevelson&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;Nevelson was known for scavenging objects from New York City debris, which she would later assemble into monumental constructions. In this one, she used disparate parts like a bedpost, juggling pin, and seat fragment, nailing and gluing them into boxes that reflect the influence of Cubism’s geometric abstraction of space and form.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/rN7hY6om.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A black matte sculpture where the individual elements are initially indistinguishable.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Aureole&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Ranjani Shettar&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;Shettar merges the traditional and the modern, the natural and the industrial. Her art focuses on the relationship between man and nature. Her work was described as compelling both abstractly and figuratively, gravity defying, and a &quot;fine synthesis of unlikely materials.&quot;&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/okTpbHhm.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A pale wire-like sculpture mounted on concrete wall and descending on the floor. It appears light.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;Hippos&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">artist</span><span class="token operator">:</span> <span class="token string">&#39;Taipei Zoo&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">description</span><span class="token operator">:</span> <span class="token string">&#39;The Taipei Zoo commissioned a Hippo Square featuring submerged hippos at play.&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&#39;https://i.imgur.com/6o5Vuyu.jpg&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">alt</span><span class="token operator">:</span> <span class="token string">&#39;A group of bronze hippo sculptures emerging from the sett sidewalk as if they were swimming.&#39;</span>
<span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 使 UI 匹配当前 state</span>
<span class="token function">updateDOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="响应事件" tabindex="-1"><a class="header-anchor" href="#响应事件" aria-hidden="true">#</a> 响应事件</h2><p>在 React 中所有事件都会冒泡，除了 onScroll，它仅适用于你附加到的 JSX 标签。可以通过<code>e.stopPropagation()</code>阻止事件冒泡。</p><p>如果你想使用捕获方式获取事件，则应该在方法名称后添加Capture来实现。</p><p>可以以属性的方式将处理函数传递下去，可以更好的追踪代码的执行。</p><p>阻止默认行为 <code>e.preventDefault()</code></p><p>事件处理函数是处理副作用的最好位置</p><p>值得一提的是React的事件机制是采用了事件委托的机制（利用了浏览器冒泡机制），这样做的好处是，只需要在React根组件中监听事件，即可监听到所有元素的事件行为，从而大大减少了性能的消耗。而Vue没有这么做。</p><h2 id="渲染" tabindex="-1"><a class="header-anchor" href="#渲染" aria-hidden="true">#</a> 渲染</h2><p>对于初次渲染，React会使用appendChild DOM API 将其创建的所有节点放在屏幕上。对于二次渲染，React将应用最少的必要操作，在渲染时计算，以使得DOM与最新的渲染输出相互匹配。</p><p>React 使用树形结构来对你创造的 UI 进行管理和建模。React 根据你的 JSX 生成 UI 树。React DOM 根据 UI 树去更新浏览器的 DOM 元素。</p><p>当你为一个组件添加 state 时，你可能会觉得 state “活”在组件内部。但实际上，state 被保存在 React 内部。根据组件在 UI 树中的位置，React 将它所持有的每个 state 与正确的组件关联起来。它是位于相同位置的相同组件，所以对 React 来说，它是同一个计数器。相同位置的不同组件会使 state 重置。当你在相同位置渲染不同的组件时，组件的整个子树都会被重置。</p><p>一般来说，如果你想在重新渲染时保留 state，几次渲染中的树形结构就应该相互“匹配”。结构不同就会导致 state 的销毁，因为 React 会在将一个组件从树中移除时销毁它的 state。</p><h3 id="更新步骤" tabindex="-1"><a class="header-anchor" href="#更新步骤" aria-hidden="true">#</a> 更新步骤</h3><p>当你调用setState设置值会触发React的更新DOM</p><p>React在重新渲染一个组件时，依次执行以下：</p><ol><li>再次调用的你的函数（组件）</li><li>你的函数会返回新的JSX快照</li><li>React会更新界面匹配你的快照</li></ol><h3 id="flushsync" tabindex="-1"><a class="header-anchor" href="#flushsync" aria-hidden="true">#</a> flushSync</h3><p>在 React 中，state 更新是排队进行的。通常，这就是你想要的。但是，在这个示例中会导致问题，因为 setTodos 不会立即更新 DOM。因此，当你将列表滚动到最后一个元素时，尚未添加待办事项。这就是为什么滚动总是“落后”一项的原因。</p><p>要解决此问题，你可以强制 React 同步更新（“刷新”）DOM。 为此，从 react-dom 导入 flushSync 并将 state 更新包裹 到 flushSync 调用中：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">flushSync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">setTodos</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token operator">...</span>todos<span class="token punctuation">,</span> newTodo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

listRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span>lastChild<span class="token punctuation">.</span><span class="token function">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这将指示 React 当封装在 flushSync 中的代码执行后，立即同步更新 DOM。因此，当你尝试滚动到最后一个待办事项时，它已经在 DOM 中了：</p><h3 id="为什么不要嵌套定义组件函数" tabindex="-1"><a class="header-anchor" href="#为什么不要嵌套定义组件函数" aria-hidden="true">#</a> 为什么不要嵌套定义组件函数</h3><p>你在相同位置渲染的是 不同 的组件，所以 React 将其下所有的 state 都重置了。这样会导致 bug 以及性能问题。为了避免这个问题， 永远要将组件定义在最上层并且不要把它们的定义嵌套起来。</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>counter<span class="token punctuation">,</span> setCounter<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">MyTextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
        <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span></span>
        <span class="token attr-name">onChange</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span></span>
      <span class="token punctuation">/&gt;</span></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyTextField</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">setCounter</span><span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">点击了 </span><span class="token punctuation">{</span>counter<span class="token punctuation">}</span><span class="token plain-text"> 次</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="组件间共享状态" tabindex="-1"><a class="header-anchor" href="#组件间共享状态" aria-hidden="true">#</a> 组件间共享状态</h2><p>状态提升，一般是将子组件的状态放到父组件</p><h2 id="reducer" tabindex="-1"><a class="header-anchor" href="#reducer" aria-hidden="true">#</a> reducer</h2><p>随着组件复杂度的增加，你将很难一眼看清所有的组件状态更新逻辑。这个组件的每个事件处理程序都通过 setTasks 来更新状态。随着这个组件的不断迭代，其状态逻辑也会越来越多。为了降低这种复杂度，并让所有逻辑都可以存放在一个易于理解的地方，你可以将这些状态逻辑移到组件之外的一个称为 reducer 的函数中。</p><ol><li><p>把 useState 转化为 useReducer</p><ol><li>通过事件处理函数 dispatch actions；</li><li>编写一个 reducer 函数，它接受传入的 state 和一个 action，并返回一个新的 state；</li><li>使用 useReducer 替换 useState；</li></ol></li><li><p>Reducers 可能需要你写更多的代码，但是这有利于代码的调试和测试。</p></li><li><p>Reducers 必须是纯净的。</p></li><li><p>每个 action 都描述了一个单一的用户交互。</p></li><li><p>使用 Immer 来帮助你在 reducer 里直接修改状态。</p></li></ol><h3 id="优势劣势" tabindex="-1"><a class="header-anchor" href="#优势劣势" aria-hidden="true">#</a> 优势劣势</h3><ol><li>体积： 通常，在使用 useState 时，一开始只需要编写少量代码。而 useReducer 必须提前编写 reducer 函数和需要调度的 actions。但是，当多个事件处理程序以相似的方式修改 state 时，useReducer 可以减少代码量。</li><li>可读性： 当状态更新逻辑足够简单时，useState 的可读性还行。但是，一旦逻辑变得复杂起来，它们会使组件变得臃肿且难以阅读。在这种情况下，useReducer 允许你将状态更新逻辑与事件处理程序分离开来。</li><li>可调试性： 当使用 useState 出现问题时, 你很难发现具体原因以及为什么。 而使用 useReducer 时， 你可以在 reducer 函数中通过打印日志的方式来观察每个状态的更新，以及为什么要更新（来自哪个 action）。 如果所有 action 都没问题，你就知道问题出在了 reducer 本身的逻辑中。 然而，与使用 useState 相比，你必须单步执行更多的代码。</li><li>可测试性： reducer 是一个不依赖于组件的纯函数。这就意味着你可以单独对它进行测试。一般来说，我们最好是在真实环境中测试组件，但对于复杂的状态更新逻辑，针对特定的初始状态和 action，断言 reducer 返回的特定状态会很有帮助。</li><li>个人偏好： 并不是所有人都喜欢用 reducer，没关系，这是个人偏好问题。你可以随时在 useState 和 useReducer 之间切换，它们能做的事情是一样的！</li></ol><h3 id="usereducer" tabindex="-1"><a class="header-anchor" href="#usereducer" aria-hidden="true">#</a> useReducer</h3><p>useReducer 钩子接受 2 个参数：</p><p>一个 reducer 函数<br> 一个初始的 state</p><p>它返回如下内容：</p><p>一个有状态的值<br> 一个 dispatch 函数（用来 “派发” 用户操作给 reducer）</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token punctuation">[</span>tasks<span class="token punctuation">,</span> dispatch<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useReducer</span><span class="token punctuation">(</span>tasksReducer<span class="token punctuation">,</span> initialTasks<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">tasksReducer</span><span class="token punctuation">(</span><span class="token parameter">tasks<span class="token punctuation">,</span> action</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>action<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token string">&#39;added&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">[</span>
        <span class="token operator">...</span>tasks<span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          <span class="token literal-property property">id</span><span class="token operator">:</span> action<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
          <span class="token literal-property property">text</span><span class="token operator">:</span> action<span class="token punctuation">.</span>text<span class="token punctuation">,</span>
          <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&#39;changed&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> tasks<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>id <span class="token operator">===</span> action<span class="token punctuation">.</span>task<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> action<span class="token punctuation">.</span>task<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> t<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">case</span> <span class="token string">&#39;deleted&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> tasks<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> t<span class="token punctuation">.</span>id <span class="token operator">!==</span> action<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">&#39;未知 action：&#39;</span> <span class="token operator">+</span> action<span class="token punctuation">.</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="useimmerreducer" tabindex="-1"><a class="header-anchor" href="#useimmerreducer" aria-hidden="true">#</a> useImmerReducer</h3><p>Reducers 应该是纯净的，所以它们不应该去修改 state。而 Immer 为你提供了一种特殊的 draft 对象，你可以通过它安全的修改 state。在底层，Immer 会基于当前 state 创建一个副本。这就是为什么通过 useImmerReducer 来管理 reducers 时，可以修改第一个参数，且不需要返回一个新的 state 的原因。</p><h2 id="context" tabindex="-1"><a class="header-anchor" href="#context" aria-hidden="true">#</a> Context</h2><p>类似于vue中provide的机制</p><p>实现组件值传值</p><p>“如果在 <code>&lt;Section&gt;</code> 组件中的任何子组件请求 LevelContext，给他们这个 level。”组件会使用 UI 树中在它上层最近的那个 <code>&lt;LevelContext.Provider&gt;</code> 传递过来的值。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> LevelContext <span class="token operator">=</span> <span class="token function">createContext</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Heading</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> level <span class="token operator">=</span> <span class="token function">useContext</span><span class="token punctuation">(</span>LevelContext<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> LevelContext <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./LevelContext.js&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Section</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> level<span class="token punctuation">,</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>section</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>section<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LevelContext.Provider</span></span> <span class="token attr-name">value</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>level<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">LevelContext.Provider</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>section</span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>你将一个 level 参数传递给 <code>&lt;Section&gt;</code>。</li><li>Section 把它的子元素包在 <code>&lt;LevelContext.Provider value={level}&gt;</code> 里面。</li><li>Heading 使用 <code>useContext(LevelContext)</code> 访问上层最近的 LevelContext 提供的值。</li></ol><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>从 传递 props 开始。 如果你的组件看起来不起眼，那么通过十几个组件向下传递一堆 props 并不罕见。这有点像是在埋头苦干，但是这样做可以让哪些组件用了哪些数据变得十分清晰！维护你代码的人会很高兴你用 props 让数据流变得更加清晰。</li><li>抽象组件并 将 JSX 作为 children 传递 给它们。 如果你通过很多层不使用该数据的中间组件（并且只会向下传递）来传递数据，这通常意味着你在此过程中忘记了抽象组件。举个例子，你可能想传递一些像 posts 的数据 props 到不会直接使用这个参数的组件，类似 <code>&lt;Layout posts={posts} /&gt;</code>。取而代之的是，让 Layout 把 children 当做一个参数，然后渲染 <code>&lt;Layout&gt;&lt;Posts posts={posts} /&gt;&lt;/Layout&gt;</code>。这样就减少了定义数据的组件和使用数据的组件之间的层级。</li></ol></div><h3 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景" aria-hidden="true">#</a> 使用场景</h3><ol><li>主题</li><li>当前账户</li><li>路由</li><li>状态管理</li></ol><h3 id="reducer和context混合" tabindex="-1"><a class="header-anchor" href="#reducer和context混合" aria-hidden="true">#</a> Reducer和Context混合</h3><p>随着应用的复杂性上升，context 和 reducer 的组合。这是一种强大的拓展应用并 提升状态 的方式，让你在组件树深处访问数据时无需进行太多工作。可以使用自定义的hook来获取数据和dispatch</p><h3 id="createcontext" tabindex="-1"><a class="header-anchor" href="#createcontext" aria-hidden="true">#</a> createContext</h3><p>能让你创建一个 context 以便组件能够提供和读取。</p><h2 id="useref" tabindex="-1"><a class="header-anchor" href="#useref" aria-hidden="true">#</a> useRef</h2><p>使用引用值，与useState不同，修改ref不会重新渲染。ref的格式为<code>{current: number}</code>。</p><table><thead><tr><th>ref</th><th>state</th></tr></thead><tbody><tr><td>useRef(initialValue)返回 { current: initialValue }</td><td>useState(initialValue) 返回 state 变量的当前值和一个 state 设置函数 ( [value, setValue])</td></tr><tr><td>更改时不会触发重新渲染</td><td>更改时触发重新渲染。</td></tr><tr><td>可变 —— 你可以在渲染过程之外修改和更新 current 的值。</td><td>“不可变” —— 你必须使用 state 设置函数来修改 state 变量，从而排队重新渲染。</td></tr><tr><td>你不应在渲染期间读取（或写入） current 值。</td><td>你可以随时读取 state。但是，每次渲染都有自己不变的 state 快照。</td></tr></tbody></table><p>你可以认为<code>useRef</code>是这样实现的</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// React 内部</span>
<span class="token keyword">function</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token parameter">initialValue</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>ref<span class="token punctuation">,</span> unused<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">current</span><span class="token operator">:</span> initialValue <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> ref<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用场景-1" tabindex="-1"><a class="header-anchor" href="#使用场景-1" aria-hidden="true">#</a> 使用场景</h3><ol><li>存储 timeout ID</li><li>存储和操作 DOM 元素，我们将在 下一页 中介绍</li><li>存储不需要被用来计算 JSX 的其他对象。</li></ol><h3 id="useimperativehandle" tabindex="-1"><a class="header-anchor" href="#useimperativehandle" aria-hidden="true">#</a> useImperativeHandle</h3><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  forwardRef<span class="token punctuation">,</span> 
  useRef<span class="token punctuation">,</span> 
  useImperativeHandle
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> realInputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 只暴露 focus，没有别的</span>
    <span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      realInputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token spread"><span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>realInputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">Form</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inputRef <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">handleClick</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    inputRef<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">MyInput</span></span> <span class="token attr-name">ref</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>inputRef<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onClick</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>handleClick<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
        聚焦输入框
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>useImperativeHandle 指示 React 将你自己指定的对象作为父组件的 ref 值。 所以 Form 组件内的 inputRef.current 将只有 focus 方法。在这种情况下，ref “句柄”不是 DOM 节点，而是你在 useImperativeHandle 调用中创建的自定义对象。</p><h3 id="react何时添加refs" tabindex="-1"><a class="header-anchor" href="#react何时添加refs" aria-hidden="true">#</a> React何时添加refs</h3><ol><li>在 渲染 阶段， React 调用你的组件来确定屏幕上应该显示什么。</li><li>在 提交 阶段， React 把变更应用于 DOM。</li></ol><p>通常，你将从事件处理器访问 refs。 如果你想使用 ref 执行某些操作，但没有特定的事件可以执行此操作，你可能需要一个 effect。我们将在下一页讨论 effect。</p><h3 id="使用-refs-操作-dom-的最佳实践" tabindex="-1"><a class="header-anchor" href="#使用-refs-操作-dom-的最佳实践" aria-hidden="true">#</a> 使用 refs 操作 DOM 的最佳实践</h3><p>如果你坚持聚焦和滚动等非破坏性操作，应该不会遇到任何问题。</p><p>避免更改由 React 管理的 DOM 节点。 对 React 管理的元素进行修改、添加子元素、从中删除子元素会导致不一致的视觉结果，或与上述类似的崩溃。</p><h2 id="useeffect" tabindex="-1"><a class="header-anchor" href="#useeffect" aria-hidden="true">#</a> useEffect</h2><p>有些组件需要与外部系统同步。例如，你可能希望根据 React state 控制非 React 组件、设置服务器连接或在组件出现在屏幕上时发送分析日志。Effects 会在渲染后运行一些代码，以便可以将组件与 React 之外的某些系统同步。</p><p>类似于Vue的生命周期</p><div class="hint-container warning"><p class="hint-container-title">注意</p><p>不要随意在你的组件中使用 Effect。记住，Effect 通常用于暂时“跳出” React 代码并与一些 外部 系统进行同步。这包括浏览器 API、第三方小部件，以及网络等等。如果你想用 Effect 仅根据其他状态调整某些状态，那么 你可能不需要 Effect。</p></div><h3 id="编写规则" tabindex="-1"><a class="header-anchor" href="#编写规则" aria-hidden="true">#</a> 编写规则</h3><ol><li>编写 Effect</li><li>声明 Effect。默认情况下，Effect 会在每次渲染后都会执行。指定 Effect 依赖。大多数 Effect 应该按需执行，而不是在每次渲染后都执行。例如，淡入动画应该只在组件出现时触发。连接和断开服务器的操作只应在组件出现和消失时，或者切换聊天室时执行。</li><li>必要时添加清理（cleanup）函数。有时 Effect 需要指定如何停止、撤销，或者清除它的效果。例如，“连接”操作需要“断连”，“订阅”需要“退订”，“获取”既需要“取消”也需要“忽略”。</li></ol><h3 id="生命周期" tabindex="-1"><a class="header-anchor" href="#生命周期" aria-hidden="true">#</a> 生命周期</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">MyComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// onMounted这里的代码只会在组件挂载后执行</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// clean 清理函数</span>
      <span class="token comment">// 只在挂载时执行的useEffect中的回调函数可以理解为 unmounted</span>
      <span class="token comment">// 每次重新执行 Effect 之前，React 都会调用清理函数；组件被卸载时，也会调用清理函数。</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// onUpdated每次渲染后都会执行此处的代码</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// clean 清理函数</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>div <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="副作用包裹" tabindex="-1"><a class="header-anchor" href="#副作用包裹" aria-hidden="true">#</a> 副作用包裹</h3><p>使用 useEffect 包裹副作用，把它分离到渲染逻辑的计算过程之外：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useEffect<span class="token punctuation">,</span> useRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">VideoPlayer</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> src<span class="token punctuation">,</span> isPlaying <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isPlaying<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isPlaying<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token operator">&lt;</span>video ref<span class="token operator">=</span><span class="token punctuation">{</span>ref<span class="token punctuation">}</span> src<span class="token operator">=</span><span class="token punctuation">{</span>src<span class="token punctuation">}</span> loop playsInline <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="useeffect指定依赖" tabindex="-1"><a class="header-anchor" href="#useeffect指定依赖" aria-hidden="true">#</a> useEffect指定依赖</h3><p>如果 isPlaying 在上一次渲染时与当前相同，它应该跳过重新运行 Effect</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>isPlaying<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><div class="hint-container info"><p class="hint-container-title">相关信息</p><p>ref可以不指定在依赖中</p><p>这是因为 ref 具有 稳定 的标识：React 保证 每轮渲染中调用 useRef 所产生的引用对象时，获取到的对象引用总是相同的，即获取到的对象引用永远不会改变，所以它不会导致重新运行 Effect。因此，依赖数组中是否包含它并不重要</p></div><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>Effect 不能在服务端执行。这意味着服务器最初传递的 HTML 不会包含任何数据。客户端的浏览器必须下载所有 JavaScript 脚本来渲染应用程序，然后才能加载数据——这并不搞笑。</li><li>直接在 Effect 中获取数据容易产生网络瀑布（network waterfall）。首先渲染了父组件，它会获取一些数据并进行渲染；然后渲染子组件，接着子组件开始获取它们的数据。如果网络速度不够快，这种方式比同时获取所有数据要慢得多。</li><li>直接在 Effect 中获取数据通常意味着无法预加载或缓存数据。例如，在组件卸载后然后再次挂载，那么它必须再次获取数据。</li><li>这不是很符合人机交互原则。如果你不想出现像 条件竞争（race condition） 之类的问题，那么你需要编写更多的样板代码。</li></ol><p>开发环境下，Effect 会执行两次</p></div><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><ol><li>与事件不同，Effect 是由渲染本身，而非特定交互引起的。</li><li>Effect 允许你将组件与某些外部系统（第三方 API、网络等）同步。</li><li>默认情况下，Effect 在每次渲染（包括初始渲染）后运行。</li><li>如果 React 的所有依赖项都与上次渲染时的值相同，则将跳过本次 Effect。</li><li>不能随意选择依赖项，它们是由 Effect 内部的代码决定的。</li><li>空的依赖数组（[]）对应于组件“挂载”，即添加到屏幕上。</li><li>仅在严格模式下的开发环境中，React 会挂载两次组件，以对 Effect 进行压力测试。</li><li>如果 Effect 因为重新挂载而中断，那么需要实现一个清理函数。</li><li>React 将在下次 Effect 运行之前以及卸载期间这两个时候调用清理函数。</li><li>如果你可以在渲染期间计算某些内容，则不需要使用 Effect。</li><li>想要缓存昂贵的计算，请使用 useMemo 而不是 useEffect。</li><li>想要重置整个组件树的 state，请传入不同的 key。</li><li>想要在 prop 变化时重置某些特定的 state，请在渲染期间处理。</li><li>组件 显示 时就需要执行的代码应该放在 Effect 中，否则应该放在事件处理函数中。</li><li>如果你需要更新多个组件的 state，最好在单个事件处理函数中处理。</li><li>当你尝试在不同组件中同步 state 变量时，请考虑状态提升。</li><li>你可以使用 Effect 获取数据，但你需要实现清除逻辑以避免竞态条件。</li></ol><h2 id="usememo" tabindex="-1"><a class="header-anchor" href="#usememo" aria-hidden="true">#</a> useMemo</h2><p>缓存记忆，除非 依赖项发生变化否则不会重复执行</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useMemo<span class="token punctuation">,</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">TodoList</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> todos<span class="token punctuation">,</span> filter <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>newTodo<span class="token punctuation">,</span> setNewTodo<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> visibleTodos <span class="token operator">=</span> <span class="token function">useMemo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ✅ 除非 todos 或 filter 发生变化，否则不会重新执行</span>
    <span class="token keyword">return</span> <span class="token function">getFilteredTodos</span><span class="token punctuation">(</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>todos<span class="token punctuation">,</span> filter<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="usesyncexternalstore" tabindex="-1"><a class="header-anchor" href="#usesyncexternalstore" aria-hidden="true">#</a> useSyncExternalStore</h2><p>订阅 React state 之外的一些数据。这些数据可能来自第三方库或内置浏览器 API。</p><p>监听网络状态的变化</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;online&#39;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;offline&#39;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;online&#39;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">&#39;offline&#39;</span><span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ✅ 非常好：用内置的 Hook 订阅外部 store</span>
  <span class="token keyword">return</span> <span class="token function">useSyncExternalStore</span><span class="token punctuation">(</span>
    subscribe<span class="token punctuation">,</span> <span class="token comment">// 只要传递的是同一个函数，React 不会重新订阅</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> navigator<span class="token punctuation">.</span>onLine<span class="token punctuation">,</span> <span class="token comment">// 如何在客户端获取值</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span> <span class="token comment">// 如何在服务端获取值</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">ChatIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isOnline <span class="token operator">=</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="useeffectevent" tabindex="-1"><a class="header-anchor" href="#useeffectevent" aria-hidden="true">#</a> useEffectEvent</h2><ol><li>事件处理函数在响应特定交互时运行。</li><li>Effect 在需要同步的时候运行。</li><li>事件处理函数内部的逻辑是非响应式的。</li><li>Effect 内部的逻辑是响应式的。</li><li>你可以将非响应式逻辑从 Effect 移到 Effect Event 中。</li><li>只在 Effect 内部调用 Effect Event。</li><li>不要将 Effect Event 传给其他组件或者 Hook。</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>count<span class="token punctuation">,</span> setCount<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setCount</span><span class="token punctuation">(</span>count <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span><span class="token punctuation">{</span>count<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">useTimer</span><span class="token punctuation">(</span><span class="token parameter">callback<span class="token punctuation">,</span> delay</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> onTick <span class="token operator">=</span> <span class="token function">useEffectEvent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">onTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ✅ Good: 只在 Effect 内部局部调用</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>delay<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不需要指定 “onTick” (Effect Event) 作为依赖项</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自定义hook" tabindex="-1"><a class="header-anchor" href="#自定义hook" aria-hidden="true">#</a> 自定义Hook</h2><p>每当组件重新渲染，自定义 Hook 中的代码就会重新运行。这就是组件和自定义 Hook 都 需要是纯函数 的原因。我们应该把自定义 Hook 的代码看作组件主体的一部分。</p><p>每当你写 Effect 时，考虑一下把它包裹在自定义 Hook 是否更清晰。你不应该经常使用 Effect，所以如果你正在写 Effect 就意味着你需要“走出 React”和某些外部系统同步，或者需要做一些 React 中没有对应内置 API 的事。把 Effect 包裹进自定义 Hook 可以准确表达你的目标以及数据在里面是如何流动的。</p><p>提取自定义 Hook 让数据流清晰。输入 url，就会输出 data。通过把 Effect “隐藏”在 useData 内部，你也可以防止一些正在处理 ShippingForm 组件的人向里面添加 不必要的依赖。随着时间的推移，应用中大部分 Effect 都会存在于自定义 Hook 内部。</p><ol><li>自定义 Hook 让你可以在组件间共享逻辑。</li><li>自定义 Hook 命名必须以后跟一个大写字母的 use 开头。</li><li>自定义 Hook 共享的只是状态逻辑，不是状态本身。</li><li>你可以将响应值从一个 Hook 传到另一个，并且他们会保持最新。</li><li>每次组件重新渲染时，所有的 Hook 会重新运行。</li><li>自定义 Hook 的代码应该和组件代码一样保持纯粹。</li><li>把自定义 Hook 收到的事件处理函数包裹到 Effect Event。</li><li>不要创建像 useMount 这样的自定义 Hook。保持目标具体化。</li><li>如何以及在哪里选择代码边界取决于你。</li></ol><h2 id="usetransition" tabindex="-1"><a class="header-anchor" href="#usetransition" aria-hidden="true">#</a> useTransition</h2><p>useTransition 是一个让你在不阻塞 UI 的情况下来更新状态的 React Hook。</p><ol><li>将状态更新标记为非阻塞转换状态</li><li>在转换中更新父组件</li><li>在转换期间显示待处理的视觉状态</li><li>避免不必要的加载指示器</li><li>构建一个Suspense-enabled 的路由</li></ol><h3 id="使用-usetransition" tabindex="-1"><a class="header-anchor" href="#使用-usetransition" aria-hidden="true">#</a> 使用 useTransition</h3><p>在组件的顶层调用 useTransition，将某些状态更新标记为转换状态。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">TabContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>isPending<span class="token punctuation">,</span> startTransition<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useTransition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>useTransition 返回一个由两个元素组成的数组：</p><p>isPending 标志，告诉你是否存在待处理的转换。<br> startTransition 函数 允许你将状态更新标记为转换状态。</p><p>作用域（scope）：一个通过调用一个或多个 set 函数。 函数更新某些状态的函数。React 会立即不带参数地调用此函数，并将在作用域函数调用期间计划同步执行的所有状态更新标记为转换状态。它们将是非阻塞的，并且 不会显示不想要的加载指示器。</p><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>useTransition 是一个 Hook，因此只能在组件或自定义 Hook 内部调用。如果你需要在其他地方启动转换（例如从数据库），请调用独立的 startTransition 函数。</li><li>只有在你可以访问该状态的 set 函数时，才能将更新包装为转换状态。如果你想响应某个 prop 或自定义 Hook 值启动转换，请尝试使用 useDeferredValue。</li><li>你传递给 startTransition 的函数必须是同步的。React 立即执行此函数，标记其执行期间发生的所有状态更新为转换状态。如果你稍后尝试执行更多的状态更新（例如在一个定时器中），它们将不会被标记为转换状态。</li><li>标记为转换状态的状态更新将被其他状态更新打断。例如，如果你在转换状态中更新图表组件，但在图表正在重新渲染时开始在输入框中输入，React 将在处理输入更新后重新启动对图表组件的渲染工作。</li><li>转换状态更新不能用于控制文本输入。</li><li>如果有多个正在进行的转换状态，React 目前会将它们批处理在一起。这是一个限制，可能会在未来的版本中被删除。</li></ol></div><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">selectTab</span><span class="token punctuation">(</span><span class="token parameter">nextTab</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setTab</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">)</span><span class="token punctuation">;</span>      
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="其他api" tabindex="-1"><a class="header-anchor" href="#其他api" aria-hidden="true">#</a> 其他API</h2><h3 id="fragment" tabindex="-1"><a class="header-anchor" href="#fragment" aria-hidden="true">#</a> Fragment</h3><h3 id="profiler" tabindex="-1"><a class="header-anchor" href="#profiler" aria-hidden="true">#</a> Profiler</h3><ol><li>编程式测量渲染性能</li><li>测量应用的不同部分</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Profiler id<span class="token operator">=</span><span class="token string">&quot;App&quot;</span> onRender<span class="token operator">=</span><span class="token punctuation">{</span>onRender<span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Profiler<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="strictmode" tabindex="-1"><a class="header-anchor" href="#strictmode" aria-hidden="true">#</a> StrictMode</h3><ol><li>为整个应用启用严格模式</li><li>为应用的一部分启用严格模式</li><li>修复在开发过程中通过双重渲染发现的错误</li><li>修复在开发中通过重新运行 Effect 发现的错误</li><li>修复严格模式发出的弃用警告</li></ol><p><code>&lt;StrictMode&gt;</code> 帮助你在开发过程中尽早地发现组件中的常见错误。</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">StrictMode</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">App</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">StrictMode</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="suspense" tabindex="-1"><a class="header-anchor" href="#suspense" aria-hidden="true">#</a> Suspense</h3><p><code>&lt;Suspense&gt;</code> 允许你显示一个退路方案（fallback）直到它的子组件完成加载。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>SomeComponent <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>当内容正在加载时显示退路方案（fallback）</li><li>同时展示内容</li><li>逐步加载内容</li><li>在新内容加载时展示过时内容</li><li>阻止已经显示的内容隐藏</li><li>表明过渡正在发生</li><li>在导航时重置 Suspense 边界</li><li>为服务器错误和客户端内容提供退路方案（fallback）</li></ol><h3 id="usedebugvalue" tabindex="-1"><a class="header-anchor" href="#usedebugvalue" aria-hidden="true">#</a> useDebugValue</h3><ol><li><p>为自定义 Hook 添加标签, 在 自定义 Hook 中调用 useDebugValue，可以让 React 开发工具 显示可读的 调试值。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useDebugValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">useOnlineStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token function">useDebugValue</span><span class="token punctuation">(</span>isOnline <span class="token operator">?</span> <span class="token string">&#39;Online&#39;</span> <span class="token operator">:</span> <span class="token string">&#39;Offline&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>延迟格式化调试值</p></li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>  <span class="token function">useDebugValue</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> <span class="token parameter">date</span> <span class="token operator">=&gt;</span> date<span class="token punctuation">.</span><span class="token function">toDateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="usedeferredvalue" tabindex="-1"><a class="header-anchor" href="#usedeferredvalue" aria-hidden="true">#</a> useDeferredValue</h3><p>延迟更新 UI 的某些部分。</p><ol><li>在新内容加载期间显示旧内容。</li><li>表明内容已过时</li><li>延迟渲染 UI 的某些部分</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useDeferredValue <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SlowList <span class="token keyword">from</span> <span class="token string">&#39;./SlowList.js&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>text<span class="token punctuation">,</span> setText<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> deferredText <span class="token operator">=</span> <span class="token function">useDeferredValue</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token operator">&lt;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>input value<span class="token operator">=</span><span class="token punctuation">{</span>text<span class="token punctuation">}</span> onChange<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=&gt;</span> <span class="token function">setText</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>SlowList text<span class="token operator">=</span><span class="token punctuation">{</span>deferredText<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="useid" tabindex="-1"><a class="header-anchor" href="#useid" aria-hidden="true">#</a> useId</h3><ol><li>为无障碍属性生成唯一 ID</li><li>为多个相关元素生成 ID</li><li>为所有生成的 ID 指定共享前缀</li></ol><h3 id="useimperativehandle-1" tabindex="-1"><a class="header-anchor" href="#useimperativehandle-1" aria-hidden="true">#</a> useImperativeHandle</h3><p>类似于vue的 defineExpose</p><ol><li>向父组件暴露一个自定义的 ref 句柄</li><li>暴露你自己的命令式方法</li></ol><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> forwardRef<span class="token punctuation">,</span> useImperativeHandle <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useImperativeHandle</span><span class="token punctuation">(</span>ref<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token comment">// ... 你的方法 ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="useinsertioneffect" tabindex="-1"><a class="header-anchor" href="#useinsertioneffect" aria-hidden="true">#</a> useInsertionEffect</h3><p>可以在布局副作用触发之前将元素插入到 DOM 中。</p><p>useInsertionEffect 是为 CSS-in-JS 库的作者特意打造的。除非你正在使用 CSS-in-JS 库并且需要注入样式，否则你应该使用 useEffect 或者 useLayoutEffect。</p><h3 id="uselayouteffect" tabindex="-1"><a class="header-anchor" href="#uselayouteffect" aria-hidden="true">#</a> useLayoutEffect</h3><p>useLayoutEffect 是 useEffect 的一个版本，在浏览器重新绘制屏幕之前触发。useLayoutEffect 可能会影响性能。尽可能使用 useEffect。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useState<span class="token punctuation">,</span> useRef<span class="token punctuation">,</span> useLayoutEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">Tooltip</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ref <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tooltipHeight<span class="token punctuation">,</span> setTooltipHeight<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">useLayoutEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> height <span class="token punctuation">}</span> <span class="token operator">=</span> ref<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTooltipHeight</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="forwardref" tabindex="-1"><a class="header-anchor" href="#forwardref" aria-hidden="true">#</a> forwardRef</h3><p>允许你的组件使用 ref 将一个 DOM 节点暴露给父组件。</p><ol><li>将 DOM 节点暴露给父组件</li><li>在多个组件中转发 ref</li><li>暴露一个命令式句柄而不是 DOM 节点</li></ol><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> forwardRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> MyInput <span class="token operator">=</span> <span class="token function">forwardRef</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">MyInput</span><span class="token punctuation">(</span><span class="token parameter">props<span class="token punctuation">,</span> ref</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>render：组件的渲染函数。React 会调用该函数并传入父组件传递来的参数和 ref。返回的 JSX 将成为组件的输出。</p><h3 id="lazy" tabindex="-1"><a class="header-anchor" href="#lazy" aria-hidden="true">#</a> lazy</h3><p>lazy 能够让你在组件第一次被渲染之前延迟加载组件的代码。</p><p>对标Vue defineAsyncComponent</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> lazy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> SomeComponent <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span>load<span class="token punctuation">)</span>

<span class="token keyword">const</span> MarkdownPreview <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;./MarkdownPreview.js&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">AsyncMarkdownPreview</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token operator">&lt;</span>Suspense fallback<span class="token operator">=</span><span class="token punctuation">{</span><span class="token operator">&lt;</span>Loading <span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">}</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>Preview<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>MarkdownPreview <span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>Suspense<span class="token operator">&gt;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="memo" tabindex="-1"><a class="header-anchor" href="#memo" aria-hidden="true">#</a> memo</h3><p>memo 允许你的组件在 props 没有改变的情况下跳过重新渲染。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> MemoizedComponent <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span>SomeComponent<span class="token punctuation">,</span> arePropsEqual<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol><li>当 props 没有改变时跳过重新渲染</li><li>使用 state 更新记忆化（memoized）组件</li><li>使用 context 更新记忆化（memoized）组件</li><li>最小化 props 的变化</li><li>指定自定义比较函数</li><li>记忆化只与从父组件传递给组件的 props 有关。</li></ol><p>Component：要进行记忆化的组件。memo 不会修改该组件，而是返回一个新的、记忆化的组件。它接受任何有效的 React 组件，包括函数组件和 forwardRef 组件。</p><p>可选参数 arePropsEqual：一个函数，接受两个参数：组件的前一个 props 和新的 props。如果旧的和新的 props 相等，即组件使用新的 props 渲染的输出和表现与旧的 props 完全相同，则它应该返回 true。否则返回 false。通常情况下，你不需要指定此函数。默认情况下，React 将使用 Object.is 比较每个 prop。</p><h3 id="starttransition" tabindex="-1"><a class="header-anchor" href="#starttransition" aria-hidden="true">#</a> startTransition</h3><p>startTransition 可以让你在不阻塞 UI 的情况下更新 state。</p><div class="language-jsx line-numbers-mode" data-ext="jsx"><pre class="language-jsx"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> startTransition <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;react&#39;</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">TabContainer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>tab<span class="token punctuation">,</span> setTab<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#39;about&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">selectTab</span><span class="token punctuation">(</span><span class="token parameter">nextTab</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">startTransition</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTab</span><span class="token punctuation">(</span>nextTab<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container warning"><p class="hint-container-title">注意</p><ol><li>startTransition 没有提供一种跟踪 transition 是否处于待定状态的方法。为了在 transition 进行时显示一个待定状态的指示器，你需要使用 useTransition。</li><li>只有当你能访问某个 state 的 set 函数时，你才能将它的更新包裹到 transition 中。如果你想根据 props 或自定义 Hook 的返回值来启动一个 transition，请尝试使用 useDeferredValue。</li><li>你传递给 startTransition 的函数必须是同步的。React 会立即执行此函数，将其执行期间发生的所有 state 更新标记为 transition。如果你想试着稍后执行更多的 state 更新（例如，在 timeout 中），它们不会被标记为转换。</li><li>一个被标记为 transition 的 state 更新时将会被其他 state 更新打断。例如，如果你在 transition 内部更新图表组件，但在图表重新渲染时在输入框中打字，则 React 将先处理输入 state 更新，之后才会重新启动对图表组件的渲染工作。</li><li>transition 更新不能用于控制文本输入。</li><li>如果有多个正在进行的 transition，当前 React 会将它们集中在一起处理。这是一个限制，在未来的版本中可能会被移除。</li></ol></div><h3 id="createportal" tabindex="-1"><a class="header-anchor" href="#createportal" aria-hidden="true">#</a> createPortal</h3><p>类似于Vue teleport</p><h3 id="createroot" tabindex="-1"><a class="header-anchor" href="#createroot" aria-hidden="true">#</a> createRoot</h3><p>createRoot 允许在浏览器的 DOM 节点中创建根节点以显示 React 组件。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">createRoot</span><span class="token punctuation">(</span>domNode<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="hydrateroot" tabindex="-1"><a class="header-anchor" href="#hydrateroot" aria-hidden="true">#</a> hydrateRoot</h3><p>hydrateRoot 函数允许你在先前由 react-dom/server 生成的浏览器 HTML DOM 节点中展示 React 组件。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> root <span class="token operator">=</span> <span class="token function">hydrateRoot</span><span class="token punctuation">(</span>domNode<span class="token punctuation">,</span> reactNode<span class="token punctuation">,</span> options<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="vue和react的区别-作业帮" tabindex="-1"><a class="header-anchor" href="#vue和react的区别-作业帮" aria-hidden="true">#</a> Vue和React的区别（作业帮）</h2><p>首先是视图显示方面：Vue也好React也好，包括Solid、Svelte都是基于数据驱动的框架，在过去我们常常通过使用dom操作命令式的渲染，现在我们不再关心视图，而是专注于数据处理，通过对数据的修改来控制视图的呈现。Vue和React虽然有很多的不同，但是也有不少相同之处，除了都是基于数据驱动的之外，他们都采用虚拟DOM，都有各自的diff算法，这与新兴的无虚拟DOM的Solid等不同，在日渐复杂的应用中，虚拟DOM面临了很多挑战，比如节点过多时导致性能的下降，像无虚拟DOM的框架开始兴起，他们直接将静态的代码编译成一条条的dom操作，而不是像Vue或React在运行时通过虚拟DOM的diff来判断是否要进行更新，这极大的提高了性能，因为运行时他几乎不需要做任何的额外操作。回到正题，面对这种情况Vue和React分别给出了自己的答案，React采用了Fiber的方案，而Vue则采用了编译时优化的方案，对静态节点进行动态提升，在编译阶段就编译好，并且进行标记，Vue采用了节省内存的二进制标记，在diff时对于静态的内容直接跳过，并且使用最长递增链表的算法优化diff（这个思想来源另一个库）。然后是响应式，两者都有维护组件内状态的属性，React中采用了useState，而Vue中则使用ref，reactive，在过去时data来维护组件内的状态。在React中存在着快照这一概念，无论你是直接修改state还是通过set修改state，state的值都不会立即改变，而是在下一次渲染后生效，而Vue中则不同，修改的值会立即生效，副作用会进行队列等待执行，视图不会立即修改，而是在你修改完所有的值之后才会生效。如果你想使值生效在React中可以使用flushSync，但这往往是不建议的。还有React中useState的状态值是存储在一个全局的链表上，而Vue中则往往会出现在data或者setupResult中，当然Vue也支持出现在全局中，但无论在哪里他都是顺序无关的，这也就意味着React每次执行钩子的顺序应该是一致的，而Vue不需要。同时Vue为了做响应式做了很多工作，比如Object.defineProperty,Proxy,Reflect，ref呀还有reactive呀,而React的值就真的就是一个普通值，简单但有用。模板编译，React模板编译做的工作就比较少了，因为是直接源于JSX，所以babel的jsx就帮他做了大部分工作了，相对来说Vue模板的编译则是略显复杂尤其Vue自己搞了很多的语法糖，v-if，v-for之类的指令，主要是通过ast+transform+generator这三步完成，ast的话，就是通过一个有限状态机处理.vue文件，提取其中的script部分和style部分，这一块交给专门的compileScript和compileStyle处理，相对而言还算是符合js的css的编译，里面用了很多插件，然后再说比较复杂就是template这块，他需要自己编，处理一个个的html标签，还要考虑v-if，v-for等各种指令，一个栈维护祖先节点，先parseChildren，然后遇到标签，parseElement先找到标签开头，然后找这个标签所有属性，遍历这些属性收集，然后遇到像v-pre这样的还要回到开始，因为后面这个节点里的内容都是静态的，默认是按照动态处理的，现在按照静态的处理逻辑再来一遍，然后就到这个开标签的结尾，然后再处理标签内部的内容，此外还有parseComment等，还有RCDATA和DATA的区别。ast出来后，还要transform进一步优化，遍历整个ast，主要父子之间的关系在transform的时候更明显，分析出动态子节点，属性有变量有不是变量的，这个根据compileScript给过来的数据来判断下，看看要怎么打静态标记。generate根据transform出来的结构再生成真实的代码。然后vue3中又针对不同环境采用了三种编译方式，分别是compileSFC、compileDOM、compileSSR,在非运行时编译一般将_ctx传递给render函数，在运行时，则通过with将ctx指定为环境上下文。两者的事件监听机制也不一样，Vue中是将事件绑定到具体元素上，只不过这个绑定事件其实几乎不变，变得是这个绑定函数内部调用的那个函数。React则是采用了事件委托机制，在Root节点统一处理，事件委托对节点比较多的程序是很重要的优化。</p><h2 id="react为什么需要fiber-是为了解决什么问题的-作业帮" tabindex="-1"><a class="header-anchor" href="#react为什么需要fiber-是为了解决什么问题的-作业帮" aria-hidden="true">#</a> React为什么需要Fiber，是为了解决什么问题的（作业帮）</h2><p>当React更新一个节点时，其下属的所有的节点也要一起patch，哪怕最终这些子节点可能只有几个发生了改变，但是diff是少不了的，这也就意味当一次patch的节点数量足够多时，因为JS的单线程，且执行js和渲染时互斥交替进行的，就会阻塞浏览器渲染线程，给用户以明显卡顿的感觉。所以React引入了Fiber，在我的了解中，React是将虚拟DOM树拍平成一个链表，然后通过空闲时间帧进行diff比较，将长任务变成多个短任务</p><h2 id="react、vue项目为什么要在列表组件中写key-其作用是什么-滴滴、饿了么" tabindex="-1"><a class="header-anchor" href="#react、vue项目为什么要在列表组件中写key-其作用是什么-滴滴、饿了么" aria-hidden="true">#</a> React、Vue项目为什么要在列表组件中写key，其作用是什么？（滴滴、饿了么）</h2><p>React和Vue写key既有一定的相似性，又有一定的区别，React和Vue中都存在虚拟DOM，更新的时候都需要比较新生成的虚拟DOM与旧的虚拟DOM的区别进行按需的更新，尽量减少更新时的DOM操作，这里就用到了diff算法，而diff算法中就是利用key值来快速判断两个节点是否是相同一个节点，没有这个key就创建一个新的，而是采用比较节点相同的策略。而在React中每个state都是按顺序存储在链表上的，也对应着虚拟树上的节点，如果没有key那么React在渲染相同的组件时，不会修改他们的渲染顺序，并且会使用当前位置的state来渲染该组件，这就会导致组件错位，而使用key后，React就可以根据key来渲染组件，并且可以通过修改key值来重置组件。</p></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/studyLib/questions/004Vue.html" class="" aria-label="Vue"><!--[--><!--]--> Vue <!--[--><!--]--></a></span><span class="next"><a href="/studyLib/questions/006%E5%B7%A5%E7%A8%8B%E5%8C%96.html" class="" aria-label="工程化"><!--[--><!--]--> 工程化 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/studyLib/assets/app-72993491.js" defer></script>
  </body>
</html>
